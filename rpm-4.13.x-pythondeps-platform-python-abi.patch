From fef3b646f3facd26dc04cfccdc27c061cfe0ee37 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Miro=20Hron=C4=8Dok?= <miro@hroncok.cz>
Date: Mon, 7 Aug 2017 16:28:59 +0200
Subject: [PATCH] Generate requires and provides for platform-python(abi)

See https://fedoraproject.org/wiki/Changes/Platform_Python_Stack
---
 scripts/pythondeps.sh | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/scripts/pythondeps.sh b/scripts/pythondeps.sh
index 10a060aac..a6d97ef4f 100755
--- a/scripts/pythondeps.sh
+++ b/scripts/pythondeps.sh
@@ -13,8 +13,8 @@ case $1 in
     # generating a line of the form
     #    python(abi) = MAJOR.MINOR
     # (Don't match against -config tools e.g. /usr/bin/python2.6-config)
-    grep "/usr/bin/python.\..$" \
-        | sed -e "s|.*/usr/bin/python\(.\..\)|python(abi) = \1|"
+    egrep '/usr/(bin/|libexec/platform-)python.\..$' \
+        | sed -r -e "s@.*/usr/(bin/|libexec/(platform-))python(.\..)@\2python(abi) = \3@"
     ;;
 -R|--requires)
     shift
@@ -23,8 +23,8 @@ case $1 in
     #    /PATH/OF/BUILDROOT/usr/lib64/pythonMAJOR.MINOR/
     # generating (uniqely) lines of the form:
     #    python(abi) = MAJOR.MINOR
-    grep "/usr/lib[^/]*/python.\../.*" \
-        | sed -e "s|.*/usr/lib[^/]*/python\(.\..\)/.*|python(abi) = \1|g" \
+    egrep '/usr/lib[^/]*/(platform-|)python.\../.*' \
+        | sed -r -e "s@.*/usr/lib[^/]*/(platform-|)python(.\..)/.*@\1python(abi) = \2@g" \
         | sort | uniq
     ;;
 esac
